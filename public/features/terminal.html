
<!doctype html>
<title>Oxygen - VM</title>
<script src="./v86/libv86.js"></script>
<script>
"use strict";
window.onload = function()
{
    let availableRAM = navigator.deviceMemory || 4;
    let maxRAMBytes = availableRAM * 1024 * 1024 * 1024;
    
    let memorySize = maxRAMBytes * 0.55;
    let vgaMemorySize = maxRAMBytes * 0.5;
    
    console.log(`Detected RAM: ${availableRAM}GB, Using: ${memorySize / (1024*1024)}MB for VM`);
    
    var emulator = new V86({
        wasm_path: "v86/v86.wasm",
        memory_size: memorySize,
        vga_memory_size: vgaMemorySize,
        screen_container: document.getElementById("screen_container"),
        bios: { 
            url: "./v86/seabios.bin" 
        },
        vga_bios: { 
            url: "./v86/vgabios.bin" 
        },
        cdrom: {
            url: "./v86/nanoshell.iso"
        },
        autostart: true,
    });
    
    emulator.add_listener("emulator-ready", function() {
        console.log("Emulator ready");
    });
    
    emulator.add_listener("download-error", function(e) {
        console.error("Download error:", e);
        alert("Failed to load: " + e.file_name + ". Check that the file exists and paths are correct.");
    });
};
</script>

<div id="screen_container" style="height: 100%; width: 100%; position: fixed; top: 0px; left: 0px;">
    <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
    <canvas style="display: none"></canvas>
</div>
